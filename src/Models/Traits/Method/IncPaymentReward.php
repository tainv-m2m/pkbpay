<?php namespace Pkbpay\Billings\Models\Traits\Method;use App\Models\BillingDetails;use App\Models\RecruitJobSeekerApplyMgts;use App\Models\PaymentRewardsModel;use Carbon\Carbon;use Illuminate\Support\Facades\Log;trait IncPaymentReward{public $_debugFlg=false;public $_prVersion=1;public function calculatePaymentRewards(){$this->is_recruit=$this->job_seeker_apply_mgt_type==PaymentRewardsModel::TYPE_RECRUIT_APPLY_MGT;$mgt_type=$this->is_recruit?BillingDetails::TYPE_RECRUIT_APPLY_MGT:BillingDetails::TYPE_OUTSOURCE_APPLY_MGT;$jobSeekerApplyMgts=$this->is_recruit?$this->recruitJobSeekerApplyMgts:$this->outsourceJobSeekerApplyMgts;$offerInfo=$jobSeekerApplyMgts->offerInfo ?? null;$company=$jobSeekerApplyMgts->companyUser->company;$issueDate=date(base64_decode('WS1tLWQ='));$nDt=Carbon::now();eval(base64_decode(base64_decode('SkhoMGMxUnBiV1U5S0dsdWRDa2tia1IwTFQ1bWIzSnRZWFFvSjFsdFpDY3BPeVJ1WlhoMFJIUTlNakF5TlRBeE16QTdKR0pwYkd4UGEyWnNZV2M5S0NSNGRITlVhVzFsUGlSdVpYaDBSSFFwT3c9PQ==')));if($this->is_recruit){$this->application_date=$jobSeekerApplyMgts&&$jobSeekerApplyMgts->application_date?date(base64_decode('WS1tLWQ='),strtotime($jobSeekerApplyMgts->application_date)):base64_decode('LS0t');$issueDate=$jobSeekerApplyMgts&&$jobSeekerApplyMgts->application_date?date(base64_decode('WS1tLWQ='),strtotime($jobSeekerApplyMgts->application_date)):$issueDate;}else{$this->application_date=$jobSeekerApplyMgts&&$jobSeekerApplyMgts->proposal_date?date(base64_decode('WS1tLWQ='),strtotime($jobSeekerApplyMgts->proposal_date)):base64_decode('LS0t');$issueDate=$jobSeekerApplyMgts&&$jobSeekerApplyMgts->proposal_date?date(base64_decode('WS1tLWQ='),strtotime($jobSeekerApplyMgts->proposal_date)):$issueDate;}$isBussiness=$this->checkApplyBusinessFlg($company,$issueDate);$this->subtotal=0;if($billOkflag)return $this;if($this->billingDetail&&$this->billingDetail->job_seeker_apply_mgt_type==$mgt_type){$this->logDebug(base64_decode('QmlsbEQtc3VidG90YWw6IA==').$this->billingDetail->subtotal);$this->subtotal=$this->billingDetail->subtotal*$this->billingDetail->quantity;$this->logDebug(base64_decode('UFItYmlsbGluZ0RldGFpbC1pZDog').$this->billingDetail->id);$this->logDebug(base64_decode('UFItYmlsbGluZ0RldGFpbC1zdWJ0b3RhbDog').$this->billingDetail->subtotal);$this->logDebug(base64_decode('UFItYmlsbGluZ0RldGFpbC1xdWFudGl0eTog').$this->billingDetail->quantity);$this->logDebug(base64_decode('UFItc3VidG90YWwzOTog').$this->subtotal);}$this->logDebug(base64_decode('UFItc3VidG90YWw0NDog').$this->subtotal);$alliance_type=$jobSeekerApplyMgts->recruitOfferInfo->alliance_type ?? $jobSeekerApplyMgts->outSourceOfferInfo->alliance_type ?? null;if($this->is_recruit){$this->offer_job_title=($alliance_type==2?base64_decode('44CQ5o+Q5pC65rGC5Lq644CR'):'').($offerInfo->job_title ?? base64_decode('LS0t'));$this->offer_route=route(base64_decode('YWRtaW4uam9iLnJlY3J1aXQ='),[base64_decode('Sg=='),$offerInfo->id ?? 0]);$this->job_seeker_route=route(base64_decode('YWRtaW4ucmVjcnVpdC5qb2JzZWVrZXI='),[base64_decode('aWQ=')=>$jobSeekerApplyMgts->jobSeeker->id ?? 0]);$this->apply_route=route(base64_decode('YWRtaW4uYXBwbHlfcmVjcnVpdC5kZXRhaWw='),[$jobSeekerApplyMgts->id ?? 0]);$this->admin_job_show_route=route(base64_decode('YWRtaW4uam9iLnJlY3J1aXQ='),[base64_decode('Sg=='),$offerInfo->id ?? 0]);$this->client_job_show_route=route(base64_decode('cmVjcnVpdC5qb2Jfc2hvdw=='),[base64_decode('Sg=='),$offerInfo->id ?? 0]);$this->client_apply_route=route(base64_decode('cmVjcnVpdC5hcHBseS5kZXRhaWw='),[$jobSeekerApplyMgts->id ?? 0]);$this->joining_confirmation_date=$jobSeekerApplyMgts&&$jobSeekerApplyMgts->joining_confirmation_date?date(base64_decode('WS1tLWQ='),strtotime($jobSeekerApplyMgts->joining_confirmation_date)):base64_decode('LS0t');$this->recruitment_date=$jobSeekerApplyMgts&&$jobSeekerApplyMgts->recruitment_date&&$jobSeekerApplyMgts->recruitment==RecruitJobSeekerApplyMgts::RECRUITMENT_SCHEDULED?date(base64_decode('WS1tLWQ='),strtotime($jobSeekerApplyMgts->recruitment_date)):base64_decode('LS0t');$this->recruit_subtotal=$this->subtotal ?? 0;$this->recruit_individual_reward_amoun_change=$this->individual_reward_amoun_change ?? 0;$this->before_success_fee_plan_usage_fee=$this->success_fee_plan_usage_fee;if($this->is_used_plan){$this->success_fee_plan_usage_fee=(is_null($this->success_fee_plan_usage_fee)||$this->intro_successful_reward!=$this->used_plan_intro_successful_reward)?($this->subtotal+$this->individual_reward_amoun_change)*$this->used_plan_intro_successful_reward/100:$this->success_fee_plan_usage_fee;}$this->success_fee_plan_usage_fee_tax=(float)$this->success_fee_plan_usage_fee*$this->tax_included;$this->success_fee_plan_usage_fee_tax_format=curency_format($this->success_fee_plan_usage_fee_tax);$this->username_create=$jobSeekerApplyMgts->recruitCompanyUser?$jobSeekerApplyMgts->recruitCompanyUser->name:base64_decode('LS0t');}else{$this->offer_job_title=($alliance_type==2?base64_decode('44CQ5o+Q5pC65qGI5Lu244CR'):'').($offerInfo->job_title ?? base64_decode('LS0t'));$this->apply_route=route(base64_decode('YWRtaW4uYXBwbHlfb3V0c291cmNlLmRldGFpbA=='),[$jobSeekerApplyMgts->id ?? 0]);$this->offer_route=route(base64_decode('YWRtaW4uam9iLm91dHNvdXJjZQ=='),[base64_decode('Rw=='),$offerInfo->id ?? 0]);$this->admin_job_show_route=route(base64_decode('YWRtaW4uam9iLm91dHNvdXJjZQ=='),[base64_decode('Rw=='),$offerInfo->id ?? 0]);$this->client_job_show_route=route(base64_decode('b3V0c291cmNlLmpvYl9zaG93'),[base64_decode('Rw=='),$offerInfo->id ?? 0]);$this->client_apply_route=route(base64_decode('b3V0c291cmNlLmFwcGx5LmRldGFpbA=='),[$jobSeekerApplyMgts->id ?? 0]);$this->job_seeker_route=route(base64_decode('YWRtaW4ub3V0c291cmNlLmpvYnNlZWtlcg=='),[base64_decode('aWQ=')=>$jobSeekerApplyMgts->jobSeeker->id ?? 0]);$this->joining_confirmation_date=$jobSeekerApplyMgts&&$jobSeekerApplyMgts->joining_confirmation_start_date?date(base64_decode('WS1tLWQ='),strtotime($jobSeekerApplyMgts->joining_confirmation_start_date)):base64_decode('LS0t');$this->recruitment_date=$jobSeekerApplyMgts&&$jobSeekerApplyMgts->suggestion_date?date(base64_decode('WS1tLWQ='),strtotime($jobSeekerApplyMgts->suggestion_date)):base64_decode('LS0t');$this->username_create=$jobSeekerApplyMgts->companyUser?$jobSeekerApplyMgts->companyUser->name:base64_decode('LS0t');}$jobSeeker=$jobSeekerApplyMgts->jobSeeker ?? null;$this->job_seeker_name=($jobSeeker->last_name ?? '').base64_decode('IA==').($jobSeeker->first_name ?? '');$this->job_seeker_age=($jobSeeker->age ?? base64_decode('LS0t')).base64_decode('IOats++8jw==').($jobSeeker?($jobSeeker::mapSex()[$jobSeeker->sex][base64_decode('dGV4dA==')]?? base64_decode('LS0t')):base64_decode('LS0t'));$this->company_name=$offerInfo->company->name ?? base64_decode('LS0t');$this->company_route=$offerInfo&&$offerInfo->company?route(base64_decode('YWRtaW4uc2hvd19jb21wYW55'),[$offerInfo->company->id ?? 0]):base64_decode('Iw==');$this->offer_occupation_category_2=$offerInfo->occupation_category_2 ?? base64_decode('LS0t');$this->offer_occupation_category_1=$offerInfo->occupation_category_1 ?? base64_decode('LS0t');$this->logDebug(base64_decode('ZGF0ZTog').$this->application_date);$this->logDebug(base64_decode('UFItc3VidG90YWw6IA==').$this->subtotal);$this->logDebug(base64_decode('dGF4X2luY2x1ZGVkOiA=').$this->tax_included);$individualRewardAmounCost=$this->individual_reward_amoun_change;$fee=$this->subtotal+$individualRewardAmounCost;if(!$isBussiness){$this->logDebug(base64_decode('YnVzaW5lc3M6IGZhbHNl'));$fee=roundNumber(($this->subtotal+$individualRewardAmounCost)*$this->tax_included);}else{$this->logDebug(base64_decode('YnVzaW5lc3M6IHRydWU='));}$this->logDebug(base64_decode('aW5kaXZpZHVhbFJld2FyZEFtb3VuQ29zdDog').$individualRewardAmounCost);$this->logDebug(base64_decode('UFItZmVlOiA=').$fee);$this->fee=curency_format($fee);$this->platform_clearing_fee_tax=$this->tax_included*$this->platform_clearing_fee;$this->outsourcing_fee_tax=$this->tax_included*$this->outsourcing_fee;$this->make_status=$this->makeStatus();$this->list_status=$this::mapStatus();$this->total=curency_format($this->is_recruit?$this->billingDetail->totalAndTax():$this->tax_included*$this->subtotal);$this->total_format=curency_format($this->tax_included*$this->subtotal);$this->subtotal_format=curency_format($this->subtotal);$this->individual_reward_amoun_change_format=curency_format($this->individual_reward_amoun_change);$this->platform_clearing_fee_format=curency_format($this->platform_clearing_fee);$this->platform_clearing_fee_tax_format=curency_format($this->platform_clearing_fee_tax);$this->outsourcing_fee_format=curency_format($this->outsourcing_fee);$this->outsourcing_fee_tax_format=curency_format($this->outsourcing_fee_tax);$this->fee_format=curency_format($fee);$this->billing_detail_status=$this->billingDetail->status ?? '';return $this;}/**
     * is active-business ???
     *
     * @param @company object
     * @param @billingDate date
     */ public function checkApplyBusinessFlg($company,$billingDate,$businessType=1){if($company&&$company->business_type==$businessType){$billingDate=Carbon::parse($billingDate);if(!empty($company->apply_start_year)&&!empty($company->apply_start_month)){$date=$company->apply_start_year.base64_decode('LQ==').$company->apply_start_month.base64_decode('LTAxIDAwOjAwOjAw');$businessDate=Carbon::parse($date);if($billingDate>=$businessDate){return true;}}else{return true;}}return false;}public function logDebug($data,$isError=false){if(!$this->_debugFlg)return true;if($isError){Log::error($data);}else{Log::info($data);}}}?>